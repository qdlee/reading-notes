# 事件

## HTML5事件

### 1、contextmenu事件

* 显示上下文菜单
* 由于contextmenu事件是冒泡的，因为可以为document指定一个事件处理程序，用以处理页面中发生的所有此类事件。
* 事件目标是发生用户操作的元素。
* 通常使用contextmenu事件来显示自定义的上下文菜单，而使用onlick事件处理程序来隐藏该菜单。

### 2、beforeunload事件

在浏览器卸载页面前触发，可以通过它来通知用户页面将被卸载，由用户决定是否卸载页面。

为了显示这个弹出对话框，必须将event.returnValue的值设置为要显示给用户的字符串(对IE及Firefox而言)，同时作为函数的返回值返回(对Safari和Chrome而言)。

### 3、DOMContentloaded事件

在形成完整的DOM树之后就会触发。

### 4、pageshow和pagehide事件

往返缓存(back-forward cache或者bfcache):用于在前进、后退时加快页面的转换速度。缓存中保存着页面中的所有数据。

如果页面从bfcache中被加载，就不会触发load事件。

pageshow事件在页面加载完成时(load事件之后)就会触发，无论是否从bfcache中加载。

pageshow事件的event对象包含一个名为persisted的布尔值属性：true-页面在bfcache中，false-页面不在bfcache中。

pagehide在页面卸载时触发(unload事件之前)。

pageshow事件的event对象包含一个名为persisted的布尔值属性：true-页面将被保存在bfcache中，false-页面不被保存在bfcache中。

这两事件都在document上触发但事件处理程序必须添加到window对象。

指定了onunload事件处理程序的页面会被自动排除在bfcache之外，即使事件处理程序是空的。

### 5、hashchange事件
在URL的参数列表(及URL中"#"号后面的所有字符串)发生变化时触发。
必须把hashchange事件处理程序添加给window对象。

##设备事件

### 1、orientationchange事件(Safari)

确定用户何时将设备由横向查看模式切换为纵向查看模式。
window.orientation属性中包含3个值：0-肖像模式，90-左旋转的横向模式(按钮在右侧)，-90-向右旋转的横向模式(按钮在左侧)

### 2、deviceorientation事件

在加速计检测到设备方向变化时在 window 对象上触发

### 3、devicemotion事件

这个事件是要告诉开发人员设备
什么时候移动，而不仅仅是设备方向如何改变。

## 触摸事件

* touchstart:当手指触摸屏幕时触发；即使已经有一个手指放在了屏幕上也会触发。
* touchmove:当手指在屏幕上滑动时连续地触发。在这个事件发生期间，调用preventDefault()可以阻止滚动。
* touchend:当手指从屏幕上移开时触发。
* touchcancel:当系统停止跟踪触摸时触发。

除了常见的DOM属性外，触摸事件还包含下列三个用于跟踪触摸的属性。

* touches:表示当前跟踪的触摸操作的Touch对象的数组。
* targetTouches:特定于事件目标的Touch对象的数组。
* changeTouches:表示自上次触摸以来发生了什么改变的Touch对象的数组。

每个Touch对象包含下列属性：

* 坐标(client,page,screen)
* identifier:标识触摸的唯一ID
* target:触摸的DOM节点目标。

## 手势事件

* gesturestart:当一个手指已经按在屏幕上面而另一个手指又触摸屏幕时触发。
* gesturechange:当触摸屏幕的任何一个手指的位置发生变化时触发
* gestureend:当任何一个手指从屏幕上面移开时触发

只有两个手指都触摸到事件的接收容器时才会触发这些事件。在一个元素上设置事件处理程序，意味着两个手指都必须同时位于该元素的范围之内，才能触发手势事件。

手势事件的event对象包含两个额外的属性：

* rotation:表示手指变化引起的旋转角度，负值表示逆时针旋转，正值表示顺时针旋转(值从0开始)。
* scale:表示两个手指间距离的变化情况。值从1开始，并随距离拉大而增长，随距离缩短而减小。

一般来说，使用基于两个手指的手势事件，要比管理触摸事件中的所有交互要容易得多。

## 内存和性能

1. 使用事件委托
2. 在将标签从DOM中移除时要先移除事件。

## 事件模拟

# 错误处理

## 常见的错误类型

根据要使用的数据的类型来进行数据类型检测，只要不符合的都错误。

### 1、类型转换错误

类型转换错误发生在使用某个操作符，或者使用其他可能会自动转换值的数据类型的语言结构时。在使用相等(==)和不相等(!=)操作符，或者在if、for、及while等流控制语句中使用非布尔值时，最常发生类型转换错误。

应该使用全等(===)和不全等(!===)操作符，以避免类型转换。

要做到在条件比较时切实传入布尔值。

### 2、数据类型错误

进行类型检测。

基本类型的值应该使用typeof来检测，而对象的值则应该使用instanceof来检测。根据使用函数的方式，有时候并不需要逐个检测所有参数的数据类型。但是，面向公众的API则必须无条件地执行类型检查，以确保函数始终能够正常地执行。

### 通信错误

对URL中的查询字符串使用encodeURIComponent()对数据进行编码。

## 致命错误和非致命错误

### 非致命错误

* 不影响用户的主要任务
* 只影响页面的一部分
* 可以恢复
* 重复相同操作可以消除错误

### 致命错误

* 应用程序根本无法继续运行
* 错误明显影响到了用户的主要操作
* 会导致其他连带错误

## 记录错误

把错误集中记录到服务器